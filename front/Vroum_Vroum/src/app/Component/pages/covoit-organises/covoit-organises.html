<h2>Mes covoiturages organisés</h2>

<div class="actions">
  <button class="btn btn-primary" (click)="allerVersCreation()">
    Publier une annonce
  </button>
</div>

<table *ngIf="covoitsOrganises.length > 0; else noData" class="table">
  <thead>
  <tr>
    <th>Date</th>
    <th>Départ</th>
    <th>Arrivée</th>
    <th>Places dispo</th>
    <th>Distance</th>
    <th>Durée</th>
  </tr>
  </thead>
  <tbody>
  <tr *ngFor="let covoit of covoitsOrganises">
    <td>{{ covoit.date | date:'short' }}</td>
    <td>{{ covoit.adresseDepart?.nomVille }} ({{ covoit.adresseDepart?.codePostal }})</td>
    <td>{{ covoit.adresseArrivee?.nomVille }} ({{ covoit.adresseArrivee?.codePostal }})</td>
    <td>{{ covoit.nbPlaces }}</td>
    <td>{{ covoit.distance }} km</td>
    <td>{{ covoit.duree | number }} min</td>
    <td>
      <button class="btn btn-primary" (click)="modifier(covoit.id)">Modifier</button>
    </td>
    <td>
      <button class="btn btn-danger btn-sm" (click)="ouvrirPopup(covoit)">Annuler</button>
    </td>
  </tr>
  </tbody>
</table>

<ng-template #noData>
  <p>Aucun covoiturage organisé pour le moment.</p>
</ng-template>

<div class="popup-overlay" *ngIf="popupVisible">
  <div class="popup">
    <h3>Annuler la réservation</h3>

    <p><strong>Date :</strong> {{ covoitSelectionne?.date | date:'short' }}</p>
    <p><strong>Trajet :</strong> {{ covoitSelectionne?.adresseDepart?.nomVille }} → {{ covoitSelectionne?.adresseArrivee?.nomVille }}</p>
    <p><strong>Conducteur :</strong> {{ covoitSelectionne?.organisateur?.prenom }} {{ covoitSelectionne?.organisateur?.nom }}</p>

    <div class="popup-actions">
      <button class="btn btn-secondary" (click)="fermerPopup()">Fermer</button>
      <button class="btn btn-danger" (click)="confirmerAnnulation(covoitSelectionne)">Confirmer l'annulation</button>
    </div>
  </div>
</div>
