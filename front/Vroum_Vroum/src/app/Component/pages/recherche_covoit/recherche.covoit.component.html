<h2>Rechercher un covoiturage</h2>

<form (ngSubmit)="rechercher()" style="margin-bottom: 20px;">
  <div>
    <label>Ville de départ :</label>
    <input [(ngModel)]="filtres.villedep" name="villedep" placeholder="Ex : Paris" />
    <label>Code postal départ :</label>
    <input [(ngModel)]="filtres.cpdep" name="cpdep" placeholder="75000" />
  </div>

  <div>
    <label>Ville d'arrivée :</label>
    <input [(ngModel)]="filtres.villearr" name="villearr" placeholder="Ex : Lyon" />
    <label>Code postal arrivée :</label>
    <input [(ngModel)]="filtres.cparr" name="cparr" placeholder="69000" />
  </div>

  <div>
    <label>Date de départ :</label>
    <input type="datetime-local" [(ngModel)]="filtres.date" name="date" />
  </div>

  <button type="submit">Rechercher</button>
</form>

<p *ngIf="erreurMessage" style="color: red;">{{ erreurMessage }}</p>

<table *ngIf="covoiturages.length > 0" border="1" cellpadding="5" cellspacing="0">
  <thead>
  <tr>
    <th>Départ</th>
    <th>Arrivée</th>
    <th>Date</th>
    <th>Conducteur</th>
    <th>Véhicule</th>
  </tr>
  </thead>
  <tbody>
  <tr *ngFor="let c of covoiturages">
    <td>{{ c.adresseDepart?.nomVille }} ({{ c.adresseDepart?.codePostal }})</td>
    <td>{{ c.adresseArrivee?.nomVille }} ({{ c.adresseArrivee?.codePostal }})</td>
    <td>{{ c.date | date:'short' }}</td>
    <td>{{ c.organisateur?.prenom }} {{ c.organisateur?.nom }}</td>
    <td>{{ c.vehicule?.marque }} {{ c.vehicule?.modele }}</td>
    <td>
      <button (click)="ouvrirPopup(c)">Réserver</button> <!-- Bouton d'action -->
    </td>
  </tr>
  </tbody>
</table>

<div *ngIf="popupVisible" class="popup-overlay">
  <div class="popup-content">
    <h3>Confirmation de réservation</h3>
    <p><strong>Départ :</strong> {{ covoiturageSelectionne?.adresseDepart?.nomVille }} ({{ covoiturageSelectionne?.adresseDepart?.codePostal }})</p>
    <p><strong>Arrivée :</strong> {{ covoiturageSelectionne?.adresseArrivee?.nomVille }} ({{ covoiturageSelectionne?.adresseArrivee?.codePostal }})</p>
    <p><strong>Date :</strong> {{ covoiturageSelectionne?.date | date:'short' }}</p>
    <p><strong>Conducteur :</strong> {{ covoiturageSelectionne?.organisateur?.prenom }} {{ covoiturageSelectionne?.organisateur?.nom }}</p>

    <div class="popup-buttons">
      <button (click)="validerReservation()">Valider</button>
      <button (click)="fermerPopup()">Annuler</button>
    </div>
  </div>
</div>

